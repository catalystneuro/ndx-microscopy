groups:
  - neurodata_type_def: MicroscopyTable
    neurodata_type_inc: DynamicTable
    doc: Extends DynamicTable to hold metadata on the Microscopy system.
    datasets:
      - name: location
        neurodata_type_inc: VectorData
        dtype: text
        shape:
          - null
        doc: Imaged location.
        quantity: "?"
      - name: coordinates
        neurodata_type_inc: VectorData
        dtype: float
        shape:
          - null
          - 3
        doc: If a GRIN lens is used, the GRIN lens placement in stereotactic coordinates (AP, ML, DV) mm relative to Bregma.
        quantity: "?"
        attributes:
          - name: unit
            dtype: text
            value: millimeters
            doc: coordinates unit
      - name: indicator
        neurodata_type_inc: VectorData
        dtype:
          target_type: Indicator
          reftype: object
        shape:
          - null
        doc: Link to the indicator object.
      - name: notes
        neurodata_type_inc: VectorData
        dtype: text
        shape:
          - null
        doc: Description of system.
        quantity: "?"
      - name: microscope
        neurodata_type_inc: VectorData
        dtype:
          target_type: Microscope
          reftype: object
        shape:
          - null
        doc: Link to the microscope device.
      - name: excitation_source
        neurodata_type_inc: VectorData
        dtype:
          target_type: ExcitationSource
          reftype: object
        shape:
          - null
        doc: Link to the excitation source device.
      - name: photodetector
        neurodata_type_inc: VectorData
        dtype:
          target_type: Photodetector
          reftype: object
        shape:
          - null
        doc: Link to the photodetector device.
      - name: dichroic_mirror
        neurodata_type_inc: VectorData
        dtype:
          target_type: DichroicMirror
          reftype: object
        shape:
          - null
        doc: Link to the dichroic mirror device.
        quantity: "?"
      - name: emission_filter
        neurodata_type_inc: VectorData
        dtype:
          target_type: OpticalFilter
          reftype: object
        shape:
          - null
        doc: Link to the emission filter device.
        quantity: "?"
      - name: excitation_filter
        neurodata_type_inc: VectorData
        dtype:
          target_type: OpticalFilter
          reftype: object
        shape:
          - null
        doc: Link to the excitation filter device.
        quantity: "?"
      - name: objective_lens
        neurodata_type_inc: VectorData
        dtype:
          target_type: ObjectiveLens
          reftype: object
        shape:
          - null
        doc: Link to the objective lens device.
        quantity: "?"

  - neurodata_type_def: Microscopy
    neurodata_type_inc: LabMetaData
    doc: Extends LabMetaData to hold all Microscopy metadata.
    groups:
      - neurodata_type_inc: MicroscopyTable
        doc: The table containing the metadata on the Microscopy system.

  - neurodata_type_def: ImagingSpace
    neurodata_type_inc: NWBContainer
    doc: Metadata about the region of physical space that imaging data was recorded from.
    datasets:
      - name: description
        dtype: text
        doc: Description of the imaging space.
      - name: origin_coordinates
        dtype: float64
        dims:
          - - x, y, z
        shape:
          - - 3
        doc:
          Physical location in stereotactic coordinates for the first element of the grid.
          See reference_frame to determine what the coordinates are relative to (e.g., bregma).
        quantity: "?"
        attributes:
          - name: unit
            dtype: text
            default_value: micrometers
            doc: Measurement units for origin coordinates. The default value is 'micrometers'.
    attributes:
      - name: location
        dtype: text
        doc:
          General estimate of location in the brain being subset by this space.
          Specify the area, layer, etc.
          Use standard atlas names for anatomical regions when possible.
          Specify 'whole-brain' if the entire brain is strictly contained within the space.
        required: false

  - neurodata_type_def: PlanarImagingSpace
    neurodata_type_inc: ImagingSpace
    doc: Metadata about the 2-dimensional slice of physical space that imaging data was recorded from.
    datasets:
      - name: grid_spacing
        dtype: float64
        dims:
          - - x, y
        shape:
          - - 2
        doc: Amount of space between pixels in the specified unit.
          Specify 'z' only when imaging volume is a regular grid; otherwise only specify 'x' and 'y'.
          See origin_coordinates to determine where the grid begins.
        quantity: "?"
        attributes:
          - name: unit
            dtype: text
            default_value: micrometers
            doc: Measurement units for grid spacing. The default value is 'micrometers'.
    attributes:
      - name: reference_frame
        dtype: text
        doc:
          Describes the reference frame of origin_coordinates and grid_spacing.
          For example, this can be a text description of the anatomical location and orientation of the grid
          defined by origin_coords and grid_spacing or the vectors needed to transform or rotate the grid to
          a common anatomical axis (e.g., AP/DV/ML).
          This field is necessary to interpret origin_coords and grid_spacing.
          If origin_coords and grid_spacing are not present, then this field is not required.
          For example, if the microscope returns 10 x 10 images, where the first value of the data matrix
          (index (0, 0)) corresponds to (-1.2, -0.6, -2) mm relative to bregma, the spacing between pixels is 0.2 mm in
          x, 0.2 mm in y and 0.5 mm in z, and larger numbers in x means more anterior, larger numbers in y means more
          rightward, and larger numbers in z means more ventral, then enter the following --
          origin_coords = (-1.2, -0.6, -2)
          grid_spacing = (0.2, 0.2)
          reference_frame = "Origin coordinates are relative to bregma. First dimension corresponds to anterior-posterior
          axis (larger index = more anterior). Second dimension corresponds to medial-lateral axis (larger index = more
          rightward). Third dimension corresponds to dorsal-ventral axis (larger index = more ventral)."
        required: false

  - neurodata_type_def: VolumetricImagingSpace
    neurodata_type_inc: ImagingSpace
    doc: Metadata about the 3-dimensional region of physical space that imaging data was recorded from.
    datasets:
      - name: grid_spacing
        doc:
          Amount of space between pixels in (x, y) or voxels in (x, y, z), in the specified unit.
          Specify 'z' only when imaging volume is a regular grid; otherwise only specify 'x' and 'y'.
          See origin_coordinates to determine where the grid begins.
        dtype: float64
        dims:
          - - x, y, z
        shape:
          - - 3
        quantity: "?"
        attributes:
          - name: unit
            doc: Measurement units for grid spacing. The default value is 'micrometers'.
            dtype: text
            default_value: micrometers
    attributes:
      - name: reference_frame
        doc:
          Describes the reference frame of origin_coordinates and grid_spacing.
          For example, this can be a text description of the anatomical location and orientation of the grid
          defined by origin_coords and grid_spacing or the vectors needed to transform or rotate the grid to
          a common anatomical axis (e.g., AP/DV/ML).
          This field is necessary to interpret origin_coords and grid_spacing.
          If origin_coords and grid_spacing are not present, then this field is not required.
          For example, if the microscope returns 10 x 10 x 2 images, where the first value of the data matrix
          (index (0, 0, 0)) corresponds to (-1.2, -0.6, -2) mm relative to bregma, the spacing between pixels is 0.2 mm in
          x, 0.2 mm in y and 0.5 mm in z, and larger numbers in x means more anterior, larger numbers in y means more
          rightward, and larger numbers in z means more ventral, then enter the following --
          origin_coords = (-1.2, -0.6, -2)
          grid_spacing = (0.2, 0.2, 0.5)
          reference_frame = "Origin coordinates are relative to bregma. First dimension corresponds to anterior-posterior
          axis (larger index = more anterior). Second dimension corresponds to medial-lateral axis (larger index = more
          rightward). Third dimension corresponds to dorsal-ventral axis (larger index = more ventral)."
        dtype: text
        required: false

  - neurodata_type_def: MicroscopySeries
    neurodata_type_inc: TimeSeries
    doc:
      Imaging data acquired over time from an optical channel in a microscope while a light source illuminates the
      imaging space.
    datasets:
      - name: microscopy_table_region
        neurodata_type_inc: DynamicTableRegion
        doc: References row of MicroscopyTable.
        quantity: '?'

  - neurodata_type_def: PlanarMicroscopySeries
    neurodata_type_inc: MicroscopySeries
    doc:
      Imaging data acquired over time from an optical channel in a microscope while a light source illuminates a
      planar imaging space.
    datasets:
      - name: data
        doc: Recorded imaging data, shaped by (number of frames, frame height, frame width).
        dtype: numeric
        dims:
          - frames
          - height
          - width
        shape:
          - null
          - null
          - null
    links:
      - name: imaging_space
        doc:
          Link to PlanarImagingSpace object containing metadata about the region of physical space this imaging data
          was recorded from.
        target_type: PlanarImagingSpace

  - neurodata_type_def: VariableDepthMicroscopySeries
    neurodata_type_inc: PlanarMicroscopySeries
    doc:
      Volumetric imaging data acquired over an irregular number and amount of depths; for instance, when using an
      electrically tunable lens.
    datasets:
      - name: depth_per_frame_in_mm
        doc: Depth of each frame in the data array.
          These values offset the 'z' value of the origin_coordinates of the linked imaging_space object.
        dtype: numeric
        dims:
          - frames
        shape:
          - null

  - neurodata_type_def: VolumetricMicroscopySeries
    neurodata_type_inc: MicroscopySeries
    doc:
      Volumetric imaging data acquired over time from an optical channel in a microscope while a light source
      illuminates a volumetric imaging space.
      Assumes the number of depth scans used to construct the volume is regular.
    datasets:
      - name: data
        doc: Recorded imaging data, shaped by (number of frames, frame height, frame width, number of depth planes).
        dtype: numeric
        dims:
          - frames
          - height
          - width
          - depth
        shape:
          - null
          - null
          - null
          - null
    links:
      - name: imaging_space
        doc:
          Link to VolumetricImagingSpace object containing metadata about the region of physical space this imaging data
          was recorded from.
        target_type: VolumetricImagingSpace
